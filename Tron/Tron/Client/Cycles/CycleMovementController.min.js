var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},CycleMovementController=function(n){function t(i,r){n.call(this,i,r,t.MAX_SPEED),this._context=i,this.Context=this._context,this._context.position.y=50,t.Velocities||this.calculateVelocities()}return __extends(t,n),t.MAX_SPEED=1e3,t.Y_OFFSET=35,t.HALF_PI=Math.PI/2,t.TWO_PI=Math.PI*2,t.prototype.calculateVelocities=function(){t.Velocities=[],t.Velocities[0]=new THREE.Vector3(0,0,-t.MAX_SPEED),t.Velocities[Math.round(t.HALF_PI)]=new THREE.Vector3(-t.MAX_SPEED,0,0),t.Velocities[Math.round(Math.PI)]=new THREE.Vector3(0,0,t.MAX_SPEED),t.Velocities[Math.round(Math.PI+t.HALF_PI)]=new THREE.Vector3(t.MAX_SPEED,0,0)},t.prototype.stabilizeValue=function(n,t){return t.normalized()*n.normalized()>0?n-=n%Map.FLOOR_TILE_SIZE.Width:n!=0&&(n-=n%Map.FLOOR_TILE_SIZE.Width-Map.FLOOR_TILE_SIZE.Width*n.normalized()),n},t.prototype.positionOnLine=function(){this._context.position=this.GetLinePosition(this._context.position)},t.prototype.GetLinePosition=function(n){var t;return(n=n.clone(),this.Velocity.isZero())?Map.Utilities.ToPosition(this.HeadLocation,n.y):(t=this.Velocity,t.z!=0?n.z=this.stabilizeValue(n.z,t.z):t.x!=0&&(n.x=this.stabilizeValue(n.x,t.x)),n)},t.prototype.Move=function(n){this.positionOnLine(),n==="Left"?(this._context.rotation.y=(this._context.rotation.y+t.HALF_PI)%t.TWO_PI,Math.round(this._context.rotation.y)==6&&(this._context.rotation.y=0)):n==="Right"&&(this._context.rotation.y-=t.HALF_PI,this._context.rotation.y<0&&(Math.round(this._context.rotation.y)===0?this._context.rotation.y=0:this._context.rotation.y+=t.TWO_PI)),this.Velocity=t.Velocities[Math.round(this._context.rotation.y)]},t.prototype.Update=function(t){n.prototype.Update.call(this,t);var i=this.Velocity.clone().multiplyScalar(t.FractionOfSecond);this._context.position.addSelf(i)},t}(MovementController)