var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},GameHandler=function(n){function t(t,i){n.call(this),this._camera=i,this._cycleManager=new CycleManager,this._map=new Map,this._cycleController=new CycleController(t)}return __extends(t,n),t.prototype.Initialize=function(n){this._cycleManager.AddAll(n),this._map.AddAll(n),this._cycleController.AttachTo(this._cycleManager.Cycles[ConnectionManager.UserID]);var t=this._camera.GetController();t.AttachTo&&t.AttachTo(this._cycleManager.Cycles[ConnectionManager.UserID].Context)},t.prototype.ServerCollisionPayload=function(n){var t=this._cycleManager.Cycles[n.ID];t.Context.position=n.CollidedAt,t.HandleCollisionWith(null)},t.prototype.ServerMovementPayload=function(n){this._cycleManager.ServerMovementPayload(n)},t.prototype.ServerDeathPayload=function(n){var t=this._cycleManager.Remove(n.ID);return this._map.Remove(n.ID),n.ID===ConnectionManager.UserID&&(this._cycleController.Detach(),this._camera.GetController().Detach(),this._camera.Mode=FreeCameraController.MODE),t.Die(n.DiedAt),t},t.prototype.Update=function(n){this.AddAllToScene(this._cycleManager.GetPendingObjects()),this.AddAllToScene(this._map.GetPendingObjects()),this._cycleManager.Update(n),this._map.Update(n)},t}(SceneObjectCreator)