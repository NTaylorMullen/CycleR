var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},Map=function(n){function t(){var i,r;for(n.call(this),this._halfMapSize=new Size(t.MAP_SIZE.Width*.5,t.MAP_SIZE.Height*.5),this._dimensions=new Size(t.MAP_SIZE.Width/t.FLOOR_TILE_SIZE.Width,t.MAP_SIZE.Height/t.FLOOR_TILE_SIZE.Height),this._map=[],this._cycles={},i=0;i<this._dimensions.Width;i++)for(this._map[i]=[],r=0;r<this._dimensions.Height;r++)this._map[i][r]=0;t.Utilities=new MapUtilities(t.MAP_SIZE,t.FLOOR_TILE_SIZE)}return __extends(t,n),t.FLOOR_TILE_SIZE=new Size(50),t.MAP_SIZE=new Size(1e4),t.WALL_SIZE=new Size(t.MAP_SIZE.Width,2e3),t.prototype.cycleCollision=function(n){var i=t.Utilities.ToMapLocationFromController(n.MovementController),r=Math.round(n.Context.rotation.y);r===0?i.Row++:r===2?i.Column++:r===3?i.Row--:r===5&&i.Column++,console.log("Collision occured! R: "+r+" Collision Location: ( "+i.Row+", "+i.Column+" )"),n.MovementController.HeadLocation=i},t.prototype.RegisterCycles=function(n){for(var t=n.length-1;t>=0;t--)this.Add(n[t])},t.prototype.Add=function(n){var i=this;n.MovementController.HeadLocation=t.Utilities.ToMapLocationFromController(n.MovementController),this._cycles[n.ID]=n;$(n).on(Cycle.Events.OnCollision,function(){i.cycleCollision(n)})},t.prototype.Remove=function(n){delete this._cycles[n]},t.prototype.Update=function(){var i,n,r;for(i in this._cycles)n=this._cycles[i],r=t.Utilities.ToMapLocationFromController(n.MovementController),n.Colliding||(n.MovementController.HeadLocation=r),this.AddAllToScene(n.TrailManager.PullPendingContexts())},t}(SceneObjectCreator)